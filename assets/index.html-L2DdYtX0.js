import{_ as a,c as t,b as e,o as r}from"./app-BxaswAnj.js";const n="/rui-plume/assets/3.%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E-CJG10ygd.jpg",p="/rui-plume/assets/4.RDB6.0.16%E5%8F%8A%E4%BB%A5%E4%B8%8B%E9%85%8D%E7%BD%AE1-B9-VR-z7.jpg",m="/rui-plume/assets/5.RDB6.0.16%E5%8F%8A%E4%BB%A5%E4%B8%8B%E9%85%8D%E7%BD%AE2.jpg-D11sp7BA.jpg",l="/rui-plume/assets/6.RDB7%E9%85%8D%E7%BD%AE-BN5qHGWU.jpg",A="/rui-plume/assets/7.RDB%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F-B7m43DYT.jpg",o="data:image/png;base64,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",i="/rui-plume/assets/9.dump%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84-BveeXg6a.png",c="/rui-plume/assets/10.RDB%E4%BF%AE%E6%94%B9%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%E5%90%8D-CHhCaUBr.png",d="/rui-plume/assets/11.%E8%A7%A6%E5%8F%91%E5%A4%87%E4%BB%BD1-CZ_1msry.png",h="/rui-plume/assets/12.%E8%A7%A6%E5%8F%91%E5%A4%87%E4%BB%BD2-yrZO2IuO.png",g="/rui-plume/assets/13.RDB%E6%89%8B%E5%8A%A8%E4%BF%9D%E5%AD%98-CcRIPWR8.png",f="/rui-plume/assets/14.bgsave%E5%AE%98%E7%BD%91%E8%AF%B4%E6%98%8E-C4fprQ4m.png",D="/rui-plume/assets/15.lastsave%E5%91%BD%E4%BB%A4-Ci9FHPdF.png",b={};function u(B,s){return r(),t("div",null,[...s[0]||(s[0]=[e('<h1 id="rdb案例演示" tabindex="-1"><a class="header-anchor" href="#rdb案例演示"><span>RDB案例演示</span></a></h1><h3 id="需求说明" tabindex="-1"><a class="header-anchor" href="#需求说明"><span>需求说明</span></a></h3><p><img src="'+n+'" alt=""></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mtext>配置文件</mtext></mstyle></mrow><annotation encoding="application/x-tex">\\textcolor{red}{配置文件}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback" style="color:red;">配置文件</span></span></span></span>(6 VS 7)</p><p>Redis6.0.16及以下</p><p><img src="'+p+'" alt=""></p><p><img src="'+m+'" alt=""></p><p>Redis6.2以及Redis-7.0.0</p><p><img src="'+l+'" alt=""></p><h3 id="操作步骤" tabindex="-1"><a class="header-anchor" href="#操作步骤"><span>操作步骤</span></a></h3><p><img src="'+A+'" alt=""></p><h4 id="自动触发" tabindex="-1"><a class="header-anchor" href="#自动触发"><span>自动触发</span></a></h4><p>Redis7版本，按照redis.conf里配置的 save &lt;seconds&gt; &lt;changes&gt;</p><p><strong>本次案例5秒2次修改</strong></p><p><img src="'+o+'" alt=""></p><p><strong>修改dump文件保存路径</strong></p><p><img src="'+i+'" alt=""></p><p><strong>修改dump文件名称</strong></p><p><img src="'+c+'" alt=""></p><p><strong>触发备份</strong></p><p>第一种情况，5秒内保存2次</p><p><img src="'+d+'" alt=""></p><p>第二种情况，两次保存间隔超过5秒</p><p><img src="'+h+'" alt=""> 注：RDB 持久化是 Redis 的一种持久化机制，它会在 Redis 数据发生修改时对内存中的数据进行快照，然后保存到磁盘，以保证数据的持久性。通常情况下，RDB 保存快照的时间间隔由配置文件中的参数 save 决定，格式为 save &lt;seconds&gt; &lt;changes&gt;，表示在 &lt;seconds&gt; 秒内，如果数据有 &lt;changes&gt; 次修改，则会进行一次快照。</p><p>在题目描述的情况下，RDB 设置了每 5 秒进行一次快照，但是如果在 5 秒内修改次数超过了 2 次，也会进行快照。这是因为在 Redis 中，保存快照并不是在规定的时间到达后才进行，而是在修改数据时和时间间隔条件的双重限制下才进行的。</p><p>如果限制只按时间间隔来进行保存快照，则会出现两个问题：</p><p>如果时间间隔太大，那么 Redis 持久化的数据可能会丢失，并且故障恢复时的数据可能会受到影响。</p><p>如果时间间隔太小，那么数据的保存成本就会过高，并可能导致 Redis 运行效率下降。</p><p>因此，Redis 引入了按时间和数据修改次数双重限制的快照保存机制，以在灵活性和效率之间取得平衡。如果在 5 秒内修改的次数超过 2 次，则说明数据的变化较快，在此情况下保存快照并不会带来明显的性能问题。因此，Redis 将其纳入保存快照的范围，以保证数据的安全和一致性</p><p><strong>如何恢复</strong></p><p>将备份文件(dump.rdb)移动到 Redis 安装目录并启动服务即可</p><p>备份成功后故意用flushdb清空redis，看看是否可以恢复数据</p><ul><li>执行flushall/flushdb命令也会产生dump.rdb文件，但里面是空的，无意义</li></ul><p>物理恢复，一定要将服务产生的RDB文件备份一份，然后分机隔离，避免生产上物理损坏后备份文件也挂了。</p><h4 id="手动触发" tabindex="-1"><a class="header-anchor" href="#手动触发"><span>手动触发</span></a></h4><p>使用save或者bgsave命令</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mi>r</mi><mi>e</mi><mi>d</mi><mi>i</mi><mi>s</mi><mtext>提供了两个命令来生成</mtext><mi>R</mi><mi>D</mi><mi>B</mi><mtext>文件，分别是</mtext><mi>s</mi><mi>a</mi><mi>v</mi><mi>e</mi><mtext>和</mtext><mi>b</mi><mi>g</mi><mi>s</mi><mi>a</mi><mi>v</mi><mi>e</mi></mstyle></mrow><annotation encoding="application/x-tex">\\textcolor{red}{redis提供了两个命令来生成RDB文件，分别是save和bgsave}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="color:red;">re</span><span class="mord mathnormal" style="color:red;">d</span><span class="mord mathnormal" style="color:red;">i</span><span class="mord mathnormal" style="color:red;">s</span><span class="mord cjk_fallback" style="color:red;">提供了两个命令来生成</span><span class="mord mathnormal" style="margin-right:0.00773em;color:red;">R</span><span class="mord mathnormal" style="margin-right:0.02778em;color:red;">D</span><span class="mord mathnormal" style="margin-right:0.05017em;color:red;">B</span><span class="mord cjk_fallback" style="color:red;">文件，分别是</span><span class="mord mathnormal" style="color:red;">s</span><span class="mord mathnormal" style="color:red;">a</span><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">v</span><span class="mord mathnormal" style="color:red;">e</span><span class="mord cjk_fallback" style="color:red;">和</span><span class="mord mathnormal" style="color:red;">b</span><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">g</span><span class="mord mathnormal" style="color:red;">s</span><span class="mord mathnormal" style="color:red;">a</span><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">v</span><span class="mord mathnormal" style="color:red;">e</span></span></span></span></p><p><img src="'+g+'" alt=""></p><p><strong>save</strong>：在主程序中执行会<strong>阻塞</strong>当前redis服务器，直到持久化工作完成执行save命令期间，Redis不能处理其他命令，<strong>线上禁止使用</strong></p><p><strong>bgsave(默认)</strong>：</p><ul><li><p>redis会在后台异步进行快照操作，<strong>不阻塞</strong>快照同时还可以相应客户端请求，该触发方式会fork一个子进程由子进程复制持久化过程</p></li><li><p>官网说明</p><p><img src="'+f+'" alt=""></p></li><li><p>Redis会使用bgsave对当前内存中的所有数据做快照，这个操作是子进程在后台完成的，这就允许主进程同时可以修改数据。</p></li><li><p>fork是什么？ 在Linux程序中，fork()会产生一个和父进程完全相同的子进程，但子进程在此后会exec系统调用，处于效率考虑，尽量避免膨胀</p></li><li><p>LASTSAVE</p><p>可以通过lastsave命令获取最后一次成功执行快照的时间</p></li></ul><p><img src="'+D+'" alt=""></p>',42)])])}const E=a(b,[["render",u]]),w=JSON.parse('{"path":"/article/eb7hyrav/","title":"3.RDB案例演示","lang":"zh-CN","frontmatter":{"title":"3.RDB案例演示","createTime":"2025/08/25 22:29:41","permalink":"/article/eb7hyrav/","watermark":true},"readingTime":{"minutes":3.3,"words":989},"git":{"createdTime":1756136329000,"updatedTime":1756136329000,"contributors":[{"name":"HRF","username":"HRF","email":"3398775460@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/HRF?v=4","url":"https://github.com/HRF"}]},"filePathRelative":"study-notes/back-end/redis/4.Redis持久化/3.RDB案例演示.md","headers":[],"categoryList":[{"id":"3c4c90","sort":10002,"name":"study-notes"},{"id":"fe643d","sort":10003,"name":"back-end"},{"id":"46b09b","sort":10033,"name":"redis"},{"id":"3bae55","sort":4,"name":"Redis持久化"}]}');export{E as comp,w as data};
