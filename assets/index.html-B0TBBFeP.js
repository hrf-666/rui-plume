import{_ as s,c as t,b as e,o as m}from"./app-BxaswAnj.js";const n="/rui-plume/assets/53.%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E5%AE%98%E7%BD%91%E5%BB%BA%E8%AE%AE-DUHNeorU.jpg",r="/rui-plume/assets/54.%E4%BC%98%E5%85%88%E5%8A%A0%E8%BD%BDAOF-zg0-RiQl.jpg",l="/rui-plume/assets/55.%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F-DphmWaDz.jpg",o="/rui-plume/assets/56.%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96-Cn-PUNRk.jpg",i={};function p(c,a){return m(),t("div",null,[...a[0]||(a[0]=[e('<h1 id="rdb-aof混合持久化" tabindex="-1"><a class="header-anchor" href="#rdb-aof混合持久化"><span>RDB-AOF混合持久化</span></a></h1><h3 id="官网建议" tabindex="-1"><a class="header-anchor" href="#官网建议"><span>官网建议</span></a></h3><p><img src="'+n+'" alt=""></p><h3 id="rdb-vs-aof" tabindex="-1"><a class="header-anchor" href="#rdb-vs-aof"><span>RDB VS AOF</span></a></h3><p><strong>问题：</strong></p><p>可否共存？</p><p>如果共存听谁的？</p><p><strong>Redis配置文档解答：RDB和AOF共存时会优先加载AOF文件</strong></p><p><img src="'+r+'" alt=""></p><p><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mtext>数据恢复顺序和加载流程</mtext></mstyle></mrow><annotation encoding="application/x-tex">\\textcolor{red}{数据恢复顺序和加载流程}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback" style="color:red;">数据恢复顺序和加载流程</span></span></span></span></strong></p><p><img src="'+l+'" alt=""></p><h3 id="你怎么选-用哪个" tabindex="-1"><a class="header-anchor" href="#你怎么选-用哪个"><span>你怎么选？用哪个？</span></a></h3><ul><li>RDB持久化方式能够在指定的时间间隔对你的数据进行快照存储。</li><li>AOF持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以redis协议追加保存每次写的操作到文件末尾。</li></ul><h3 id="同时开启两种持久化方式" tabindex="-1"><a class="header-anchor" href="#同时开启两种持久化方式"><span>同时开启两种持久化方式</span></a></h3><ul><li>在这种情况下，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mtext>当</mtext><mi>r</mi><mi>e</mi><mi>d</mi><mi>i</mi><mi>s</mi><mtext>重启的时候会优先载入</mtext><mi>A</mi><mi>O</mi><mi>F</mi><mtext>文件来恢复原始的数据</mtext></mstyle></mrow><annotation encoding="application/x-tex">\\textcolor{red}{当redis重启的时候会优先载入AOF文件来恢复原始的数据}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord cjk_fallback" style="color:red;">当</span><span class="mord mathnormal" style="color:red;">re</span><span class="mord mathnormal" style="color:red;">d</span><span class="mord mathnormal" style="color:red;">i</span><span class="mord mathnormal" style="color:red;">s</span><span class="mord cjk_fallback" style="color:red;">重启的时候会优先载入</span><span class="mord mathnormal" style="color:red;">A</span><span class="mord mathnormal" style="margin-right:0.13889em;color:red;">OF</span><span class="mord cjk_fallback" style="color:red;">文件来恢复原始的数据</span></span></span></span>，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。</li><li>RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件。但是作者也不建议只使用AOF方式备份，因为RDB更适合用于备份数据库（AOF在不断的变化不好备份），留着RDB作为一个万一的手段。</li></ul><h3 id="推荐方式" tabindex="-1"><a class="header-anchor" href="#推荐方式"><span>推荐方式</span></a></h3><p>RDB+AOF混合方式</p><p>1开启混合方式设置 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mtext>设置</mtext><mi>a</mi><mi>o</mi><mi>f</mi><mo>−</mo><mi>u</mi><mi>s</mi><mi>e</mi><mo>−</mo><mi>r</mi><mi>d</mi><mi>b</mi><mo>−</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>m</mi><mi>b</mi><mi>l</mi><mi>e</mi><mtext>的值为</mtext><mi>y</mi><mi>e</mi><mi>s</mi><mtext>，</mtext><mi>y</mi><mi>e</mi><mi>s</mi><mtext>表示开启，设置为</mtext><mi>n</mi><mi>o</mi><mtext>表示禁用</mtext></mstyle><mtext>​</mtext></mrow><annotation encoding="application/x-tex">\\textcolor{red}{设置aof-use-rdb-preamble的值为yes， yes表示开启，设置为no表示禁用}​</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord cjk_fallback" style="color:red;">设置</span><span class="mord mathnormal" style="color:red;">a</span><span class="mord mathnormal" style="color:red;">o</span><span class="mord mathnormal" style="margin-right:0.10764em;color:red;">f</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="color:red;">u</span><span class="mord mathnormal" style="color:red;">se</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;color:red;">r</span><span class="mord mathnormal" style="color:red;">d</span><span class="mord mathnormal" style="color:red;">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="color:red;">p</span><span class="mord mathnormal" style="color:red;">re</span><span class="mord mathnormal" style="color:red;">amb</span><span class="mord mathnormal" style="margin-right:0.01968em;color:red;">l</span><span class="mord mathnormal" style="color:red;">e</span><span class="mord cjk_fallback" style="color:red;">的值为</span><span class="mord mathnormal" style="color:red;">yes</span><span class="mord cjk_fallback" style="color:red;">，</span><span class="mord mathnormal" style="color:red;">yes</span><span class="mord cjk_fallback" style="color:red;">表示开启，设置为</span><span class="mord mathnormal" style="color:red;">n</span><span class="mord mathnormal" style="color:red;">o</span><span class="mord cjk_fallback" style="color:red;">表示禁用</span><span class="mord">​</span></span></span></span> 2 RDB+AOF的混合方式---------&gt;结论:RDB镜像做全量持久化，AOF做增量持久化 先使用RDB进行快照存储，然后使用AOF持久化记录所有的写操作，当重写策略满足或手动触发重写的时候，将最新的数据存储为新的RDB记录。这样的话，重启服务的时候会从RDB和AOF两部分恢复数据，既保证了数据完整性，又提高了恢复数据的性能。简单来说:混合持久化方式产生的文件一部分是RDB格式，一部分是AOF格式。----》AOF包括了RDB头部+AOF混写</p><p><img src="'+o+'" alt=""></p>',19)])])}const h=s(i,[["render",p]]),y=JSON.parse('{"path":"/article/vjcw8mzk/","title":"9.RDB-AOF混合持久化","lang":"zh-CN","frontmatter":{"title":"9.RDB-AOF混合持久化","createTime":"2025/08/25 22:29:41","permalink":"/article/vjcw8mzk/","watermark":true},"readingTime":{"minutes":1.91,"words":572},"git":{"createdTime":1756136329000,"updatedTime":1756136329000,"contributors":[{"name":"HRF","username":"HRF","email":"3398775460@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/HRF?v=4","url":"https://github.com/HRF"}]},"filePathRelative":"study-notes/back-end/redis/4.Redis持久化/9.RDB-AOF混合持久化.md","headers":[],"categoryList":[{"id":"3c4c90","sort":10002,"name":"study-notes"},{"id":"fe643d","sort":10003,"name":"back-end"},{"id":"46b09b","sort":10033,"name":"redis"},{"id":"3bae55","sort":4,"name":"Redis持久化"}]}');export{h as comp,y as data};
