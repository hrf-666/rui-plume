---
title: 2025版Java面试场景题
tags:
  - 2025版Java面试场景题
createTime: 2025/09/02 22:29:40
permalink: /article/56fwoqbl/
---


# 2025Java面试场景题

大雨滂沱

[[toc]]

[百万级数据导出 Excel怎么性能优化，避免OOM](https://www.yuque.com/tulingzhouyu/db22bv/gogkqpk8r8gsl7rb) ztts

## 1.百万数据导出excel，解决oom

### 1.造成oom的原因

1. 一次性申请太多（找到对应的业务代码，更改申请数量）
2. 内存资源消耗未释放（找到对应的代码，进行释放）
3. 本身资源不够（jmap -heap查看对信息）

### 2.如何定位线上oom

1. 系统已经oom挂了（提前设置-xx:+heapDumpOnOutOfMemoryError -XX:HeapDumoPath=./jvm_logs）
2. 系统运行中还未oom（导出dump文件:jmap -dump:format=b,file=hrf.hprof 14660.或者使用arthas）
3. 结合jvisualvm进行调试（查看最多跟业务有关对象->找到GCRoot->查看线程栈）

## 2.cpu飙高

### 1.top

### 2.top -H -p 进程pid

（线程id转换为16进制 printf '0x%x\n' 18475）

### 3.jstack 进程pid | grep 16进制线程pid -A 20

## 3.如何快速定位&避免死锁

### 1.死锁原因

并发下线程因为相互等待对方资源，导致“永久”阻塞的现象

### 2.产生死锁的4大因素

1. 互斥：共享资源只能被一个线程占用。-互斥锁（通过原子计算，）
2. 占有且等待：线程当前占有至少一个资源并还想请求其他线程持有的其他资源就会造成等待。-等待对方释放资源（同时获取两个资源）
3. 不可抢占：资源只能有持有它的线程自愿释放，其他线程不可强行占有该资源。-无法释放对方资源（设置超时）
4. 循环等待：线程t1等待线程t2占有的资源，线程t2等待线程t1占有的资源，就是循环等待。 -两个线程相互等待（有序的等待）

### 3.怎么避免死锁

1. 银行家算法

## 4.秒杀系统如何设计

### 1.痛点

瞬时并发量大

库存少

### 2.多级负载均衡&限流&自动伸缩

商品页进行静态化同步到cdn中

活动前禁用按钮，点击后禁用按钮，滑动验证码防羊毛党，排队体验提升用户体验

nginx进行集群

rebbin负载均衡

结合docker/k8s进行云服务器的动态伸缩的部署

在nginx配置好限流，在网关层配置限流，在秒杀服务当中通过mq进行削峰填谷减轻下游的压力，防止激增流量打垮数据库

在服务端利用redis去做缓存，减轻数据库的压力。

**预热**到redis当中防止被击穿打垮数据库。

**库存**可以通过redis lua脚本去操作库存，判断库存是否大于0，如果大于0进行减一，再替换已有的库存数量。

**防重**可以在前端通过一些禁用按钮或者验证码防止重复提交，通过redis set nx命令针对同一用户tocken+商品url  ip+url 同一个时间，同一个商品只能有一个有效。

**分布式锁**利用mq，发送mq消息到mq服务器消费mq消息进行下单，数据库进行读写分离，如果数据很大的情况下考虑分库分表的手段。

## 5.阿里内部的订单超时

### 1.jdk自带的延时队列

### 2.基于mq的定时消息

### 3.redis过期时间监听

### 4.定时任务分布式处理（很重要）

任务调度schedulerX

## 5.如何防止重复下单

### 1.立即购买（下单）

前端下单按钮置为不可以

后端通过redis的setnx，保存一个key，判断key是否有值，保证多次操作只能存储一个值。当然setnx需要设置一个过期时间。用户token+url+key。

## 6.人肉机刷单，咋防止

### 1.通过setnx

### 2.登录环节

### 3.活动环节

### 4.业务风控

实名认证，消费门槛，随机优惠，限制用户的参与，中奖，奖励次数，根据用户的历史行为和忠诚度，提供不同层次的优惠，优待忠实用户，奖池限制上限

### 5.技术风控

1. 限流，自动扩容伸缩通过k8s
2. 黑名单（客服标记，系统监测）布隆过滤器
3. 大数据用户画像

## 7.分布式锁

### 1.通过redis的setnx实现分布式锁

#### 问题：

1. 当锁过期时线程还在处理业务中
2. 当处理完释放其他线程的锁

#### 解决：

1. 加长时间，并添加子线程每10确认线程是否在线，在线则将过期时间重设
2. 给锁加唯一的id（uuid）
3. redisson组件可以完成上述功能

![redisson原理](https://raw.githubusercontent.com/hrf-666/rui-picGo/master/rui-plume/public/java/image-20250902200647070.png)

## 8.扫码登录实现原理

### 1.生成二维码

![生成二维码](https://raw.githubusercontent.com/hrf-666/rui-picGo/master/rui-plume/public/java/image-20250902201022020.png)

### 2.扫码

![扫码](https://raw.githubusercontent.com/hrf-666/rui-picGo/master/rui-plume/public/java/image-20250902201128554.png)

![扫码原理](https://raw.githubusercontent.com/hrf-666/rui-picGo/master/rui-plume/public/java/image-20250902201200423.png)

### 3.验证

![确认登录](https://raw.githubusercontent.com/hrf-666/rui-picGo/master/rui-plume/public/java/image-20250902201403850.png)

## 9.如何设置分布式的日志存储架构

### 1.单体项目

### 2.分布式

1. mongodb存储

2. elk存储

3. loki

   
